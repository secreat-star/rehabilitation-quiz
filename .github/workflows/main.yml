    - name: Setup Android SDK & NDK (Controlled)
      run: |
        # 1. 在用户目录创建独立Android环境
        ANDROID_BASE="$HOME/android"
        mkdir -p "$ANDROID_BASE"
        cd "$ANDROID_BASE"

        # 2. 下载Android命令行工具
        echo "下载Android命令行工具..."
        wget -q https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
        unzip -q commandlinetools-linux-11076708_latest.zip
        rm commandlinetools-linux-11076708_latest.zip
        
        # 3. 创建正确的目录结构
        echo "创建目录结构..."
        # 先检查解压出的目录结构
        ls -la
        
        # 创建cmdline-tools目录
        mkdir -p cmdline-tools
        
        # 将解压出的cmdline-tools目录内容移动到临时位置
        if [ -d "cmdline-tools" ]; then
          # 如果解压直接产生了cmdline-tools目录
          mv cmdline-tools/* . 2>/dev/null || true
          rmdir cmdline-tools 2>/dev/null || true
        fi
        
        # 创建latest目录并移动所有工具文件到其中
        mkdir -p cmdline-tools/latest
        # 移动所有文件到latest目录（排除cmdline-tools目录自身）
        find . -maxdepth 1 -type f -exec mv {} cmdline-tools/latest/ \; 2>/dev/null || true
        find . -maxdepth 1 -type d ! -name "." ! -name "cmdline-tools" -exec mv {} cmdline-tools/latest/ \; 2>/dev/null || true

        # 4. 设置环境变量
        ANDROID_SDK_ROOT="$ANDROID_BASE"
        ANDROID_HOME="$ANDROID_SDK_ROOT"
        echo "ANDROID_SDK_ROOT=$ANDROID_SDK_ROOT" >> $GITHUB_ENV
        echo "ANDROID_HOME=$ANDROID_HOME" >> $GITHUB_ENV
        echo "$ANDROID_SDK_ROOT/cmdline-tools/latest/bin" >> $GITHUB_PATH

        # 5. 接受许可证并安装指定版本的SDK组件
        echo "安装SDK组件..."
        yes | sdkmanager --licenses > /dev/null 2>&1
        sdkmanager "platforms;android-34"
        sdkmanager "build-tools;34.0.0"
        sdkmanager "platform-tools"
        sdkmanager "cmdline-tools;latest"

        # 6. 下载并安装指定版本的NDK
        echo "下载NDK..."
        cd "$ANDROID_BASE"
        wget -q https://dl.google.com/android/repository/android-ndk-r26c-linux.zip
        unzip -q android-ndk-r26c-linux.zip
        rm android-ndk-r26c-linux.zip
        ANDROID_NDK_HOME="$ANDROID_BASE/android-ndk-r26c"
        echo "ANDROID_NDK_HOME=$ANDROID_NDK_HOME" >> $GITHUB_ENV

        # 验证安装
        echo "=== 环境验证 ==="
        echo "SDK Root: $ANDROID_SDK_ROOT"
        echo "NDK Home: $ANDROID_NDK_HOME"
        echo "目录结构:"
        find "$ANDROID_SDK_ROOT" -type d | sort
        echo "aidl工具位置:"
        ls -la "$ANDROID_SDK_ROOT/build-tools/34.0.0/aidl" 2>/dev/null || echo "aidl未找到，查看build-tools目录:"
        ls -la "$ANDROID_SDK_ROOT/build-tools/34.0.0/" 2>/dev/null || echo "build-tools目录不存在"
